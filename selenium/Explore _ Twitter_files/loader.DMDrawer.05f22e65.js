(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{"3GUV":function(e,t,r){"use strict";var a=r("ERkP"),n=r("rHpw"),s=r("MWbm");class o extends a.Component{shouldComponentUpdate(){return!1}render(){return a.createElement(s.a,{style:i.root})}}const i=n.a.create((e=>({root:{height:5*e.lineHeightsPx.body}})));t.a=o},"5UID":function(e,t,r){"use strict";var a=r("ERkP"),n=r("3XMw"),s=r.n(n),o=r("rHpw"),i=r("+/1j"),c=r("MWbm");const l=s.a.e5b0063d;let d=0;class h extends a.Component{constructor(){super(),this._listDomId=`accessible-list-${d}`,d+=1}render(){const{children:e,title:t}=this.props,r=l({title:t});return a.createElement(c.a,{accessibilityLabelledBy:this._listDomId,accessibilityRole:"region"},a.createElement(i.a,{accessibilityLevel:1,accessibilityRole:"heading",nativeID:this._listDomId,style:o.a.visuallyHidden},t),a.createElement(c.a,{accessibilityLabel:r},e))}}t.a=h},Avzu:function(e,t,r){"use strict";var a=r("ERkP"),n=r("Lsrn"),s=r("k/Ka");const o=(e={})=>Object(s.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[n.a.root,e.style],viewBox:"0 0 24 24"},a.createElement("g",null,a.createElement("path",{d:"M23.25 3.25h-2.425V.825c0-.414-.336-.75-.75-.75s-.75.336-.75.75V3.25H16.9c-.414 0-.75.336-.75.75s.336.75.75.75h2.425v2.425c0 .414.336.75.75.75s.75-.336.75-.75V4.75h2.425c.414 0 .75-.336.75-.75s-.336-.75-.75-.75zm-3.175 6.876c-.414 0-.75.336-.75.75v8.078c0 .414-.337.75-.75.75H4.095c-.412 0-.75-.336-.75-.75V8.298l6.778 4.518c.368.246.79.37 1.213.37.422 0 .844-.124 1.212-.37l4.53-3.013c.336-.223.428-.676.204-1.012-.223-.332-.675-.425-1.012-.2l-4.53 3.014c-.246.162-.563.163-.808 0l-7.586-5.06V5.5c0-.414.337-.75.75-.75h9.094c.414 0 .75-.336.75-.75s-.336-.75-.75-.75H4.096c-1.24 0-2.25 1.01-2.25 2.25v13.455c0 1.24 1.01 2.25 2.25 2.25h14.48c1.24 0 2.25-1.01 2.25-2.25v-8.078c0-.415-.337-.75-.75-.75z"})));o.metadata={width:24,height:24},t.a=o},BUB3:function(e,t,r){"use strict";var a=r("ERkP"),n=r("sNn6"),s=r("rHpw"),o=r("MWbm");const i=s.a.create((e=>({activeRoot:{backgroundColor:e.colors.gray0},overlay:{...s.a.absoluteFillObject,borderRightStyle:"solid",borderRightWidth:e.borderWidths.medium,borderRightColor:e.colors.primary,zIndex:1}})));t.a=({children:e,...t})=>a.createElement(n.a,t,(t=>a.createElement(o.a,{style:t&&i.activeRoot},"function"==typeof e?e(t):e,t?a.createElement(o.a,{pointerEvents:"none",style:i.overlay}):null)))},FS1z:function(e,t,r){"use strict";var a=r("KEM+"),n=r.n(a),s=r("ERkP"),o=r("rxPX"),i=r("0KEI");const c=(e,{module:t})=>t.selectFetchStatus(e),l=(e,{module:t})=>t.selectItems(e);var d=Object(o.a)().propsFromState((e=>({fetchStatus:c,items:l}))).propsFromActions((({module:e})=>({createLocalApiErrorHandler:Object(i.createLocalApiErrorHandlerWithContextFactory)("SLICES_TIMELINE"),fetch:e.fetch,fetchIfNeeded:e.fetchIfNeeded,fetchBottom:e.fetchBottom}))),h=r("v//M"),p=r("sIe2"),u=r("3XMw"),m=r.n(u),b=r("TEoO");const E=m.a.i9028824,_=e=>e,g={viewType:"timeline"};class y extends s.Component{constructor(...e){super(...e),n()(this,"_render",(()=>{const{footer:e,items:t,noItemsRenderer:r,numColumns:a,onScrollEnd:n,renderer:o,withoutHeadroom:i}=this.props;return!t||a<1?null:1===a?s.createElement(b.a,{cacheKey:"sliceTimeline",footer:e,identityFunction:_,items:t,noItemsRenderer:r,onNearEnd:this._handleNearEnd,onScrollEnd:n,renderer:o,withoutHeadroom:i}):s.createElement(p.a,{ListEmptyComponent:r,data:t,keyExtractor:_,numColumns:a,renderItem:o})})),n()(this,"_handleNearEnd",(()=>{const{createLocalApiErrorHandler:e,fetchBottom:t}=this.props;t().catch(e())})),n()(this,"_handleFetch",(()=>{const{alwaysFetch:e,createLocalApiErrorHandler:t,fetch:r,fetchIfNeeded:a}=this.props;(e?r:a)().catch(t())}))}componentDidMount(){this._handleFetch()}componentDidUpdate(e){const{module:t}=this.props;e.module!==t&&this._handleFetch()}render(){const{fetchStatus:e,module:t,retryMessage:r}=this.props;return t?s.createElement(h.a,{accessibilityLabel:E,behavioralEventContext:g,fetchStatus:e,onRequestRetry:this._handleFetch,render:this._render,retryMessage:r,retryable:!0}):null}}n()(y,"defaultProps",{numColumns:1,alwaysFetch:!1});const v=d(y);t.a=v},TEoO:function(e,t,r){"use strict";var a=r("ERkP"),n=r("5UID"),s=r("3GUV"),o=r("iBK2");const i=a.createElement(s.a,null),c=({accessibilityTitle:e,...t})=>{const r=a.createElement(o.b,t);return e?a.createElement(n.a,{title:e},r):r};c.defaultProps={footer:i},t.a=c},fuhe:function(e,t,r){"use strict";r.r(t),r.d(t,"DMDrawer",(function(){return Je}));var a=r("97Jx"),n=r.n(a),s=r("KEM+"),o=r.n(s),i=r("ERkP"),c=r("ZUOq"),l=r("MMRb"),d=r("RqPI"),h=r("rxPX"),p=r("0KEI");var u=Object(h.a)().propsFromState((()=>({conversations:l.selectConversations,drawerExperimentEnabled:l.selectDrawerExperimentEnabled,perspective:d.p,poppedOutConversationId:l.selectPoppedOutConversationId,visibility:l.selectDrawerVisibility}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(p.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_CONVERSATION"),fetchInboxIfNeeded:l.fetchInboxIfNeeded,loadDrawerVisibilityFromPersistence:l.loadDrawerVisibilityFromPersistence,setDrawerVisibility:l.setDrawerVisibility}))),m=r("V/6K"),b=r("CDB5"),E=r("1YZw"),_=r("hqKg"),g=r("X/yg"),y=r("AQOc"),v=r("UhuB"),f=r("l0YN"),S=r("G6rE"),I=r("P1r1");const C=(e,t)=>t.conversationId,x=Object(_.createSelector)(((e,t)=>l.selectEntriesForConversation(e,C(0,t))),d.p,((e,t)=>t?Object(g.d)(e,t):void 0)),w=e=>t=>b.c(e,t),R=e=>(t,r)=>b.a(e,t,r),O={conversation:(e,t)=>l.selectConversation(e,C(0,t)),entries:l.selectEntries,perspective:d.p,users:S.e.selectAll,dataSaverMode:I.k,dtabBarInfo:I.n,quickReplyOptions:x,visibility:l.selectDrawerVisibility,inboxUnreadCount:f.a,isUnread:(e,t)=>!l.selectConversationIsRead(e,C(0,t)),isDmReceiptSettingEnabled:v.n},T={draftText:(e,t)=>b.l(e,C(0,t)),gifMetadata:(e,t)=>b.h(e,C(0,t)),isUploading:(e,t)=>b.j(e,C(0,t)),media:(e,t)=>b.i(e,C(0,t)),mediaUploadProgress:(e,t)=>b.k(e,C(0,t))};var D=Object(h.a)().propsFromState((()=>({...O,...T}))).adjustStateProps((({conversation:e,dataSaverMode:t,draftText:r,dtabBarInfo:a,entries:n,gifMetadata:s,inboxUnreadCount:o,isDmReceiptSettingEnabled:i,isUnread:c,isUploading:l,media:d,mediaUploadProgress:h,perspective:p,quickReplyOptions:u,users:m,visibility:b})=>{const E=null==e?void 0:e.data;return{conversation:E&&Object(y.a)(E,n,m),perspective:p,dataSaverMode:t,draftText:r,dtabBarInfo:a,gifMetadata:s,inboxUnreadCount:o,isDmReceiptSettingEnabled:i,isUploading:l,isUnread:c,media:d,mediaUploadProgress:h,quickReplyOptions:u,visibility:b}})).propsFromActions((({conversationId:e})=>({addMedia:R(e),addToast:E.b,createLocalApiErrorHandler:Object(p.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_CONVERSATION"),fetchConversationHistory:l.fetchConversationHistory,removeMedia:w(e),saveText:b.f,sendMessage:b.m,updateConversationReadState:l.updateConversationReadState,updateTyping:l.updateTyping,fetchUpdatesIfNeeded:l.fetchUpdatesIfNeeded}))).withAnalytics({page:"messages",section:"thread_drawer"}),M=r("aWyx"),L=r("qz2E"),H=r("Oi4X"),P=r("OhSZ"),N=Object(h.a)().propsFromState((()=>({visibility:l.selectDrawerVisibility}))).propsFromActions((()=>({popOutConversation:l.popOutConversation,setDrawerVisibility:l.setDrawerVisibility}))).withAnalytics(),A=r("AQ79"),F=r("3XMw"),k=r.n(F),B=r("OrGc"),j=r("hACr"),U=r("fs1G"),G=r("MWbm"),V=r("/yvb"),q=r("Znyr"),Q=r("t62R"),W=r("xKuM"),z=r("rHpw"),$=r("v6aA"),K=r("95Se"),X=r("Avzu"),Y=r("Lsrn"),Z=r("k/Ka");const J=(e={})=>Object(Z.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[Y.a.root,e.style],viewBox:"0 0 24 24"},i.createElement("g",null,i.createElement("path",{d:"M12 19.344l-8.72-8.72c-.293-.293-.768-.293-1.06 0s-.294.768 0 1.06l9.25 9.25c.292.294.767.294 1.06 0l9.25-9.25c.146-.145.22-.337.22-.53s-.073-.383-.22-.53c-.293-.292-.768-.292-1.06 0L12 19.344z"}),i.createElement("path",{d:"M12 11.535l-8.72-8.72c-.293-.293-.768-.293-1.06 0s-.294.768 0 1.06l9.25 9.25c.292.294.767.294 1.06 0l9.25-9.25c.146-.145.22-.337.22-.53s-.073-.383-.22-.53c-.293-.292-.768-.292-1.06 0L12 11.535z"})));J.metadata={width:24,height:24};var ee=J;const te=(e={})=>Object(Z.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[Y.a.root,e.style],viewBox:"0 0 24 24"},i.createElement("g",null,i.createElement("path",{d:"M12 4.656l8.72 8.72c.293.293.768.293 1.06 0s.294-.768 0-1.06l-9.25-9.25c-.292-.294-.767-.294-1.06 0l-9.25 9.25c-.146.145-.22.337-.22.53s.073.383.22.53c.293.292.768.292 1.06 0L12 4.656z"}),i.createElement("path",{d:"M12 12.465l8.72 8.72c.293.293.768.293 1.06 0s.294-.768 0-1.06l-9.25-9.25c-.292-.294-.767-.294-1.06 0l-9.25 9.25c-.146.145-.22.337-.22.53s.073.383.22.53c.293.292.768.292 1.06 0l8.72-8.72z"})));te.metadata={width:24,height:24};var re=te,ae=r("hOZg"),ne=r("x0mb");const se=k.a.a2f8105f,oe=k.a.e839db39,ie=k.a.d227d19e,ce=k.a.c64c1883,le=k.a.j7d0e835,de=k.a.b08821f3,he=k.a.e736990a,pe=k.a.cdcebd22;class ue extends i.Component{constructor(...e){super(...e),o()(this,"_headerBar",i.createRef()),o()(this,"_showDMQuickAccessWithClose",this.context.featureSwitches.isTrue("responsive_web_dm_quick_access_with_close_enabled")),o()(this,"_appBarScrollEnabled",this.context.featureSwitches.isTrue("responsive_web_app_bar_scroll_enabled")),o()(this,"_isExpanded",(()=>{const{visibility:e}=this.props;return e===A.a.EXPANDED})),o()(this,"_renderLeftControl",(()=>{const{inboxUnreadCount:e}=this.props;return i.createElement(G.a,null,i.createElement(V.a,{accessibilityLabel:de,icon:i.createElement(K.a,null),onPress:this._handleUnpopConvo,type:this._getButtonType()}),e&&e>0?i.createElement(q.a,{pip:!0,style:me.newMessagePip,truncatedCountFormatter:()=>"",unreadCountLabel:()=>""}):null)})),o()(this,"_getButtonType",(()=>{const{hasNewMessages:e,isHighlighted:t}=this.props;return t&&e?"onMediaText":"primaryText"})),o()(this,"_renderRightControl",(()=>{const{conversationTitle:e}=this.props,t=this._isExpanded(),r=this._getButtonType();return i.createElement(G.a,{style:me.rightControls},e?null:i.createElement(V.a,{accessibilityLabel:ce,hoverLabel:{label:pe},icon:i.createElement(X.a,null),onPress:this._handleNewMessage,type:r}),t?i.createElement(V.a,{accessibilityLabel:ie,hoverLabel:{label:ie},icon:i.createElement(ee,null),onPress:this._handleToggleVisibility,type:r}):i.createElement(V.a,{accessibilityLabel:le,hoverLabel:{label:le},icon:i.createElement(re,null),onPress:this._handleToggleVisibility,type:r}),this._showDMQuickAccessWithClose?i.createElement(V.a,{accessibilityLabel:oe,icon:i.createElement(ae.a,null),onPress:this._handleClose,type:r}):null)})),o()(this,"_handleUnpopConvo",(()=>{const{popOutConversation:e}=this.props;e(null)})),o()(this,"_handleToggleVisibility",(()=>{const{analytics:e,onDrawerOpen:t,setDrawerVisibility:r}=this.props,a=this._isExpanded()?A.a.COLLAPSED:A.a.EXPANDED;a===A.a.COLLAPSED?e.scribe({action:"collapse"}):a===A.a.EXPANDED&&(e.scribe({action:"expand"}),t&&t()),r(a)})),o()(this,"_handleToggleVisibilityKeyboard",(()=>{this._handleToggleVisibility(),this._headerBar&&this._headerBar.current&&this._headerBar.current.focus()})),o()(this,"_handleClose",(()=>{const{analytics:e,setDrawerVisibility:t}=this.props;e.scribe({action:"close"}),t(A.a.CLOSED)})),o()(this,"_handleNewMessage",(()=>{const{analytics:e,history:t}=this.props;e.scribe({section:"compose_drawer",component:"dm",action:"show"}),t.push({pathname:"/messages/compose",state:{source:"drawer"}})})),o()(this,"_renderTitle",(()=>{const{conversationTitle:e,hasNewMessages:t,isHighlighted:r}=this.props,a=e||i.createElement(Q.b,null,se);return i.createElement(G.a,{style:me.titleContainer},i.createElement(G.a,{style:[me.titleTextRoot,r&&t?me.titleTextHighlighted:null]},a),t?i.createElement(G.a,{style:me.newMessageDotContainer},i.createElement(ne.a,{accessibilityLabel:he,style:[me.newMessageDotRoot,r?me.newMessageDotHighlighted:me.newMessageDotRegular]})):null)}))}componentDidUpdate(e){const{hasNewMessages:t,isHighlighted:r,triggerHighlight:a}=this.props;e.isHighlighted||r||e.hasNewMessages||!t||a&&a()}render(){const{conversationSubtitle:e,conversationTitle:t,hasNewMessages:r,isHighlighted:a}=this.props,n=r?a?[me.headerHighlighted]:[me.headerActive]:[],s=this._isExpanded(),o=this._appBarScrollEnabled&&!a;return i.createElement(j.a,{enabled:!0,handlers:{[B.e.goLists]:U.a,[B.e.toggleDMDrawer]:this._handleToggleVisibilityKeyboard}},i.createElement(G.a,{ref:this._headerBar,style:[me.headerRoot,!s&&me.headerBorderClosed,...n,me.cursor]},i.createElement(W.a,{leftControl:t&&this._isExpanded()?this._renderLeftControl():null,onMiddleControlClick:this._handleToggleVisibility,rightControl:this._renderRightControl(),style:this._appBarScrollEnabled?me.roundedAppBarCorners:null,subtitle:e,title:this._renderTitle(),withBackground:o,withBottomBorder:!0})))}}o()(ue,"contextType",$.a);const me=z.a.create((e=>({root:{alignSelf:"flex-end",backgroundColor:e.colors.navigationBackground,borderColor:e.colors.borderColor,borderWidth:e.borderWidths.small,marginRight:e.spaces.space20,width:c.a.columnWidths.secondary.normal},cursor:{cursor:"pointer"},expanded:{height:c.a.columnWidths.secondary.normal},headerRoot:{borderTopLeftRadius:e.borderRadii.xLarge,borderTopRightRadius:e.borderRadii.xLarge,transition:"all 0.3s ease"},headerBorderClosed:{borderColor:e.colors.navigationBackground},headerActive:{backgroundColor:e.colors.unreadCellBackground},headerHighlighted:{borderColor:e.colors.primary,backgroundColor:e.colors.primary},titleContainer:{alignItems:"center",display:"flex",flexDirection:"row",flexGrow:1},titleTextRoot:{flexGrow:1,flexShrink:1},titleTextHighlighted:{color:e.colors.white},roundedAppBarCorners:{borderTopLeftRadius:e.borderRadii.xLarge,borderTopRightRadius:e.borderRadii.xLarge},newMessageDotContainer:{flexGrow:1},newMessageDotRoot:{width:e.spaces.space12,height:e.spaces.space12,marginLeft:e.spaces.space4},newMessageDotRegular:{color:e.colors.primary},newMessageDotHighlighted:{color:e.colors.white},newMessagePip:{right:e.spaces.space4,top:e.spaces.space4},rightControls:{flexDirection:"row"}})));var be=N(ue),Ee=r("zb92");var _e=Object(Ee.a)({loader:()=>r.e(19).then(r.bind(null,"Rk1B"))}),ge=r("aWzz"),ye=r("XnpN"),ve=r("GSsg"),fe=r("aITJ"),Se=r("yrzJ");class Ie extends i.Component{constructor(e,t){super(e,t),o()(this,"_appBarScrollEnabled",this.context.featureSwitches.isTrue("responsive_web_app_bar_scroll_enabled")),o()(this,"_composer",i.createRef()),o()(this,"_renderConversation",((e,t)=>{const{conversationId:r,history:a,location:n}=this.props;return i.createElement(H.a,{conversationId:r,drawerHeader:this._appBarScrollEnabled?this._renderHeader():void 0,history:a,isWide:!1,location:n,richTextInputContext:e,typeaheadWrapper:t})})),o()(this,"_isExpanded",(()=>{const{visibility:e}=this.props;return e===A.a.EXPANDED})),o()(this,"_fetchUpdatesIfNeeded",(()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchUpdatesIfNeeded:r,isDmReceiptSettingEnabled:a}=this.props;r(a?{active_conversation_id:e,dm_users:!0}:{}).catch(t())})),Object(L.a)()}componentDidMount(){this._updatePolling()}componentDidUpdate(e){e.visibility!==this.props.visibility&&this._updatePolling()}render(){const e=this._isExpanded();return i.createElement(i.Fragment,null,e&&this._appBarScrollEnabled?null:this._renderHeader(),e?fe.b.isDesktopOS()?i.createElement(_e,null,(({richTextInputContext:e,typeaheadWrapper:t})=>this._renderConversation(e,t))):this._renderConversation():null)}_renderHeader(){const{conversation:e,history:t,inboxUnreadCount:r,isHeaderHighlighted:a,isUnread:n,onDrawerOpen:s,perspective:o,triggerHeaderHighlight:c}=this.props,l=a?"white":"normal",d=a?"white":"gray700",h=e&&e.type===M.a.ONE_TO_ONE&&o&&Object(ye.a)(e,o).map((({user:e})=>e.screen_name)),p=h?i.createElement(Se.a,{color:d,screenName:h[0]}):void 0;return i.createElement(G.a,{style:this._appBarScrollEnabled?[Ce.headerRoot,Ce.appBarZIndex]:Ce.appBarZIndex},i.createElement(be,{conversationSubtitle:p,conversationTitle:i.createElement(P.b,{conversation:e,perspective:o,textColor:l,withScreenName:!1}),hasNewMessages:n,history:t,inboxUnreadCount:r,isHighlighted:a,onDrawerOpen:s,triggerHighlight:c}))}_updatePolling(){this._pollingTimer&&this._pollingTimer.stop(),this.props.visibility===A.a.COLLAPSED&&(this._pollingTimer=new ve.a(this._fetchUpdatesIfNeeded,{interval:3e3}),this._pollingTimer.start())}getChildContext(){return{getCustomLocation:null}}}o()(Ie,"contextType",$.a),o()(Ie,"childContextTypes",{getCustomLocation:ge.func});const Ce=z.a.create((e=>({appBarZIndex:{zIndex:e.componentZIndices.appBarZIndex},headerRoot:{position:"sticky",top:0}})));var xe=D(Ie),we=r("4q8G"),Re=r("tn7R");var Oe=Object(h.a)().propsFromState((()=>({conversations:l.selectConversations,settings:I.g,unreadCount:f.a,untrustedConversationCount:l.selectUntrustedConversationCount,untrustedUnreadCount:l.selectUntrustedUnreadCount,visibility:l.selectDrawerVisibility}))).adjustStateProps((({conversations:e,settings:t,unreadCount:r,untrustedConversationCount:a,untrustedUnreadCount:n,visibility:s})=>{const o=[];for(const t of Object(Re.a)(e)){var i;!t.isDeleted&&null!==(i=t.data)&&void 0!==i&&i.trusted&&o.push(t.data)}o.sort(we.a);const c=r>0;return{allowUntrustedInbox:"all"===t.allow_dms_from||a>0,conversationIds:o.map((e=>e.conversation_id)),isUnread:c,untrustedUnreadCount:n,visibility:s}})).propsFromActions((()=>({createLocalApiErrorHandler:Object(p.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_INBOX"),fetchInbox:l.fetchInbox,fetchInboxHistory:l.fetchTrustedInboxHistory,fetchInboxIfNeeded:l.fetchInboxIfNeeded,fetchUpdates:l.fetchUpdatesIfNeeded,updateLastSeenEventId:l.updateTrustedLastSeenEventId,popOutConversation:l.popOutConversation}))).withAnalytics({page:"messages",section:"inbox_drawer"}),Te=r("cFyg"),De=r("pXKu"),Me=r("yw4N"),Le=r("FIs5"),He=r("csss");const Pe=k.a.a2f8105f,Ne=k.a.b8aa3744,Ae=k.a.j06309e1,Fe=k.a.gee5150a,ke=k.a.cf2d1047,Be=k.a.da2f9224,je=k.a.h6beb5fa;class Ue extends i.Component{constructor(...e){super(...e),o()(this,"_appBarScrollEnabled",this.context.featureSwitches.isTrue("responsive_web_app_bar_scroll_enabled")),o()(this,"_renderHeader",(()=>{const{history:e,isHeaderHighlighted:t,isUnread:r,onDrawerOpen:a,triggerHeaderHighlight:n}=this.props;return i.createElement(G.a,{style:this._appBarScrollEnabled?[Ge.headerRoot,Ge.appBarZIndex]:Ge.appBarZIndex},i.createElement(be,{hasNewMessages:r,history:e,isHighlighted:t,onDrawerOpen:a,triggerHighlight:n}))})),o()(this,"_renderExpandedInbox",(()=>{const{analytics:e,conversationIds:t,fetchInboxHistory:r,updateLastSeenEventId:a}=this.props;return i.createElement(G.a,{style:Ge.fill},i.createElement(G.a,{style:[Ge.viewportView,this._appBarScrollEnabled&&Te.b.drawerHeaderRadius]},i.createElement(Me.a,{style:[Ge.viewportView,this._appBarScrollEnabled&&Te.b.drawerHeaderRadius]},this._appBarScrollEnabled&&this._renderHeader(),i.createElement(De.a,{accessibilityTitle:Pe,analytics:e,conversationIds:t,customCellClick:this._dmDrawerOnClick,fetchInboxHistory:r,isDrawer:!0,renderEmptyDMInbox:this._renderEmptyDMInbox,renderStickyContent:this._renderPivot,updateLastSeenEventId:a,virtualScrollerCacheKey:"dmDrawerInbox"}))))})),o()(this,"_renderEmptyDMInbox",(()=>i.createElement(i.Fragment,null,this._renderPivot(),i.createElement(Le.a,{buttonLink:"/messages/compose",buttonText:Fe,header:Ne,message:Ae,onImpression:this._handleEmptyDMInboxImpression})))),o()(this,"_isExpanded",(()=>{const{visibility:e}=this.props;return e===A.a.EXPANDED})),o()(this,"_dmDrawerOnClick",((e,t)=>{const{popOutConversation:r}=this.props;r(t),e.preventDefault()})),o()(this,"_handleEmptyDMInboxImpression",(()=>{const{analytics:e}=this.props;e.scribe({component:"empty_message",action:"impression"})})),o()(this,"_handleRequestsPivotClick",(()=>{const{analytics:e}=this.props;e.scribe({element:"requests_pivot",action:"click"})})),o()(this,"_renderPivot",(()=>{const{allowUntrustedInbox:e}=this.props;return e?i.createElement(G.a,{style:Ge.requestPivotContainer},i.createElement(He.a,{label:ke,link:"/messages/requests",onPress:this._handleRequestsPivotClick,renderRightContent:this._renderPivotBadge})):null})),o()(this,"_renderPivotBadge",(()=>{const{untrustedUnreadCount:e}=this.props;return e>0?i.createElement(q.a,{count:e,standalone:!0,truncatedCountFormatter:je,unreadCountLabel:Be}):null}))}componentDidUpdate(){this._isExpanded()&&Object(L.a)()}render(){const e=this._isExpanded();return i.createElement(i.Fragment,null,e&&this._appBarScrollEnabled?null:this._renderHeader(),e&&this._renderExpandedInbox())}}o()(Ue,"contextType",$.a);const Ge=z.a.create((e=>({fill:{flex:1,alignSelf:"stretch"},headerRoot:{position:"sticky",top:0},appBarZIndex:{zIndex:e.componentZIndices.appBarZIndex},requestPivotContainer:{backgroundColor:e.colors.cellBackground,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor,zIndex:2},viewportView:{...z.a.absoluteFillObject,overflowY:"auto"}})));var Ve=Oe(Ue),qe=r("YeIG"),Qe=r("A69o"),We="DMDrawer",ze=r("TnY3"),$e=r("0FVZ"),Ke=r("Oe3h"),Xe=r("nBUg");const Ye={isGlobal:!0,isSticky:!0},Ze={isGlobal:!0,isSticky:!1};class Je extends i.PureComponent{constructor(...e){super(...e),o()(this,"state",{isHeaderHighlighted:!1,hasStartedInitialFetch:!1,unexpandedHeight:void 0}),o()(this,"_handleLayout",(e=>{const{nativeEvent:{layout:{height:t}}}=e,{unexpandedHeight:r}=this.state;this._isExpanded()||void 0!==r||this.setState({unexpandedHeight:t})})),o()(this,"_showDMDrawer",(()=>{const{conversations:e,visibility:t}=this.props,r=t===A.a.CLOSED;return!this._isHideDMDrawerPath()&&!Object(qe.a)(e)&&!r})),o()(this,"_isExpanded",(()=>{const{visibility:e}=this.props;return e===A.a.EXPANDED})),o()(this,"_triggerHeaderHighlight",(()=>{const{isHeaderHighlighted:e}=this.state;this._isExpanded()||e||this._headerHighlightTimeoutId||(this.setState({isHeaderHighlighted:!0}),this._headerHighlightTimeoutId=setTimeout((()=>{this.setState({isHeaderHighlighted:!1}),this._headerHighlightTimeoutId=void 0}),3e3))})),o()(this,"_handleDrawerOpen",(()=>{const{isHeaderHighlighted:e}=this.state;e&&(this.setState({isHeaderHighlighted:!1}),clearTimeout(this._headerHighlightTimeoutId),this._headerHighlightTimeoutId=void 0)})),o()(this,"_isOnOcfFlow",(()=>{const{location:e}=this.props;return e.pathname.startsWith("/i/flow")})),o()(this,"_isOnBirdwatchPage",(()=>{const{location:e}=this.props;return e.pathname.startsWith("/i/birdwatch")})),o()(this,"_isHideDMDrawerPath",(()=>this._isOnOcfFlow()||this._isOnBirdwatchPage()))}componentWillUnmount(){clearTimeout(this._headerHighlightTimeoutId)}componentDidUpdate(){this._loadInboxDataIfNeeded()}componentDidMount(){this._loadInboxDataIfNeeded()}render(){const{history:e,location:t,perspective:r,poppedOutConversationId:a,width:s}=this.props,{isHeaderHighlighted:o,unexpandedHeight:c}=this.state,l=this._isExpanded();return this._showDMDrawer()?i.createElement($e.a.Drawer,null,i.createElement(Ke.a,{id:"DMDrawer"},((d,h)=>i.createElement(m.a.Provider,{value:{isDrawer:!0}},i.createElement(Xe.a.Provider,{value:{isDMDrawer:()=>!0}},i.createElement(G.a,n()({ref:d()},h({style:[Te.b.root,{width:s}],testID:We})),i.createElement(G.a,{onLayout:c?void 0:this._handleLayout,style:[Te.b.expandable,{height:c,maxHeight:c},l&&Te.b.expanded]},a?i.createElement(Qe.a.Provider,{value:Ze},i.createElement(xe,{conversationId:a,history:e,isHeaderHighlighted:o,location:t,onDrawerOpen:this._handleDrawerOpen,perspective:r,triggerHeaderHighlight:this._triggerHeaderHighlight})):i.createElement(Qe.a.Provider,{value:Ye},i.createElement(Ve,{history:e,isHeaderHighlighted:o,onDrawerOpen:this._handleDrawerOpen,triggerHeaderHighlight:this._triggerHeaderHighlight}))))))))):null}_loadInboxDataIfNeeded(){const{createLocalApiErrorHandler:e,fetchInboxIfNeeded:t,loadDrawerVisibilityFromPersistence:r}=this.props,{hasStartedInitialFetch:a}=this.state;this._isHideDMDrawerPath()||a||(r(),t().catch(e()),this.setState({hasStartedInitialFetch:!0}))}}o()(Je,"defaultProps",{width:c.a.dmDrawerWidth.max});const et=u(Je);t.default=Object(ze.a)(et)},pXKu:function(e,t,r){"use strict";var a=r("KEM+"),n=r.n(a),s=r("ERkP"),o=r("BUB3"),i=r("v6aA"),c=r("xZGM"),l=r("rxPX");var d=Object(l.a)().propsFromState((()=>({shouldShowPrompt:(e,t)=>Object(c.y)(e,c.j)}))).propsFromActions((()=>({addFlag:c.v}))).withAnalytics({component:"dm_education_flags_prompt"}),h=r("fs1G"),p=r("t62R"),u=r("feu+"),m=r("3XMw"),b=r.n(m);const E=b.a.fd6150fc,_=s.createElement(b.a.I18NFormatMessage,{$i18n:"iac7f92a"},s.createElement(p.b,{link:"/privacy"},b.a.d42d239f)),g=b.a.j24c37b2;var y=d((e=>{const{addFlag:t,analytics:r,shouldShowPrompt:a}=e,{featureSwitches:n}=s.useContext(i.a);if(!(a&&n.isTrue("dm_education_flags_prompt")))return!1;return r.scribeAction("impression"),s.createElement(u.a,{actionLabel:g,headline:E,onAction:()=>{r.scribeAction("click"),t(c.j)},onClose:h.a,subtext:_,withCloseButton:!1})})),v=r("MMRb"),f=r("kGix"),S=r("0KEI");var I=Object(l.a)().propsFromState((()=>({hasConversations:v.selectHasConversations,fetchStatus:v.selectFetchStatus,isLoadingTop:v.selectIsLoadingTop}))).adjustStateProps((({fetchStatus:e,hasConversations:t,isLoadingTop:r})=>({fetchStatus:t?f.a.LOADED:e,isRefreshing:t&&r}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(S.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_INBOX"),fetchInbox:v.fetchInbox,fetchInboxIfNeeded:v.fetchInboxIfNeeded,fetchUpdates:v.fetchUpdatesIfNeeded}))),C=(r("MvUL"),r("EbOo")),x=r("tZH3"),w=r("1YZw"),R=r("hqKg"),O=r("AQOc"),T=r("G6rE"),D=r("oEGd");const M=(e,t)=>t.conversationId,L=Object(R.createSelector)(M,((e,t)=>v.selectConversation(e,M(0,t))),v.selectEntries,T.e.selectAll,((e,t)=>!v.selectConversationIsRead(e,M(0,t))),((e,t)=>{const r=M(0,t);return Object(v.selectInboxTypeByConversation)(e,r)}),((e,t,r,a,n,s)=>({conversation:(null==t?void 0:t.data)&&Object(O.a)(t.data,r,a),conversationId:e,unread:n,inboxType:s}))),H={addRecentSearch:v.addRecentSearches,addToast:w.b,block:T.e.block,createLocalApiErrorHandler:Object(S.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_INBOX_ITEM"),leaveConversation:v.leaveConversation,muteDMUser:v.muteDMUser,unmuteDMUser:v.unmuteDMUser,unblock:T.e.unblock};var P=Object(D.g)(L,H),N=r("aA19"),A=r("OhSZ"),F=r("g54k");const k=(e,t)=>t.entry;var B=Object(l.a)().propsFromState((()=>({users:Object(R.createSelector)(T.e.selectAll,k,F.b)}))).adjustStateProps((({users:e})=>({...e}))),j=r("zQEV");var U=B((({entry:e,entryType:t,perspective:r,users:a})=>{const n=Object(j.a)(e,t,r,a);return s.createElement(p.b,{color:"gray700"},n)}));const G=Object(R.createSelector)(((e,t)=>T.e.select(e,t.senderId)),((e,t)=>t.recipientId?T.e.select(e,t.recipientId):void 0),((e,t)=>({user:e,recipient:t})));var V=Object(D.c)(G),q=r("X/yg"),Q=r("cTG8");const W=e=>s.createElement(b.a.I18NFormatMessage,{$i18n:"b3a2b11c"},s.createElement(p.b,null,e)),z=b.a.dedfd265;const $=b.a.a876e58b,K=b.a.bf584cd1,X=b.a.a9cc8cfd,Y=b.a.e20b65b0,Z=b.a.e5bfe07d,J=b.a.b1a614fe;var ee=V((({entry:e,perspective:t,isGroupDM:r,user:a={},recipient:n={}})=>{const{featureSwitches:o}=s.useContext(i.a),c=e&&e.message_data;if(!c)return null;const{attachment:l}=c,d=l&&!!(l.video||l.photo||l.animated_gif||l.tweet||l.fleet||l.sticker||l.card),h=t===a.id_str,u=!(!d||!h)||!(!r||h),m=a.name,E=n.name;let _=[u&&s.createElement(p.b,{key:"senderName"},W(m)," "),c&&c.text&&s.createElement(Q.a,{displayTextRange:[0,c.text.length],entities:c.entities,key:"message",text:c.text,withMediaLinks:!0})];return l&&(l.tweet?_=u?((e,t)=>e?s.createElement(p.b,null,b.a.d5b762c8):s.createElement(b.a.I18NFormatMessage,{$i18n:"dfd2b3b9"},s.createElement(p.b,null,t)))(h,m):J:l.fleet?_=((e,t,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"i005f1fd"},s.createElement(p.b,null,t),s.createElement(p.b,null,r||"")):s.createElement(b.a.I18NFormatMessage,{$i18n:"b35cee40"},s.createElement(p.b,null,r||"")))(h,E,c.text):l.video?_=Object(q.k)(l,o)?u?function(e,t){return e?s.createElement(p.b,null,b.a.h7033cac):s.createElement(b.a.I18NFormatMessage,{$i18n:"be5a9616"},s.createElement(p.b,null,t))}(h,m):z:u?((e,t)=>e?s.createElement(p.b,null,b.a.j7d81019):s.createElement(b.a.I18NFormatMessage,{$i18n:"eee2f120"},s.createElement(p.b,null,t)))(h,m):$:l.photo?_=u?((e,t)=>e?s.createElement(p.b,null,b.a.f80629ba):s.createElement(b.a.I18NFormatMessage,{$i18n:"c1e1f848"},s.createElement(p.b,null,t)))(h,m):K:l.animated_gif?_=u?((e,t)=>e?s.createElement(p.b,null,b.a.eb3d722e):s.createElement(b.a.I18NFormatMessage,{$i18n:"dc4b75a1"},s.createElement(p.b,null,t)))(h,m):X:l.sticker?_=u?((e,t)=>e?s.createElement(p.b,null,b.a.d30c2d4f):s.createElement(b.a.I18NFormatMessage,{$i18n:"c7e2464e"},s.createElement(p.b,null,t)))(h,m):Y:l.card&&(_=u?((e,t)=>e?s.createElement(p.b,null,b.a.db53c017):s.createElement(b.a.I18NFormatMessage,{$i18n:"hcbbbb34"},s.createElement(p.b,null,t)))(h,m):Z)),s.createElement(p.b,{color:"gray700",numberOfLines:1},_)})),te=r("uKEd");const re=(e,t)=>t.senderId?T.e.select(e,t.senderId):void 0,ae=(e,t)=>Object(te.n)(e,t.reactionEntry.message_id),ne=(e,t)=>{const r=ae(e,t);return r&&r.message_data&&T.e.select(e,r.message_data.sender_id)};var se=Object(D.e)((()=>Object(R.createSelector)(re,ae,ne,((e,t,r)=>({reactedMessageEntry:t,reactingUser:e,messageUser:r})))),{}),oe=r("33Kz");var ie=se((({isGroupDM:e,messageUser:t,perspective:r,reactedMessageEntry:a,reactingUser:n,reactionEntry:o})=>{const{featureSwitches:c}=s.useContext(i.a),l=a&&a.message_data,d=l&&l.attachment,h=l&&l.text,u=t&&t.screen_name,m=r===(n&&n.id_str),E=n&&n.name,_=Object(oe.b)(o.reaction_key||"",c);let g;return g=d&&d.tweet?e?((e,t,r,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"c4202784"},s.createElement(p.b,null,r),s.createElement(p.b,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"b493a890"},s.createElement(p.b,null,t),s.createElement(p.b,null,r),s.createElement(p.b,null,a)))(m,E,u,_):((e,t,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"ca684bf5"},s.createElement(p.b,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"h5797be5"},s.createElement(p.b,null,t),s.createElement(p.b,null,r)))(m,E,_):d&&d.video?e?((e,t,r,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"d1f8bdd9"},s.createElement(p.b,null,r),s.createElement(p.b,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"d764af97"},s.createElement(p.b,null,t),s.createElement(p.b,null,r),s.createElement(p.b,null,a)))(m,E,u,_):((e,t,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"ab1cdfe2"},s.createElement(p.b,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"f0cf1699"},s.createElement(p.b,null,t),s.createElement(p.b,null,r)))(m,E,_):d&&d.photo?e?((e,t,r,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"hec0fd4d"},s.createElement(p.b,null,r),s.createElement(p.b,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"j55320de"},s.createElement(p.b,null,t),s.createElement(p.b,null,r),s.createElement(p.b,null,a)))(m,E,u,_):((e,t,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"jf27606a"},s.createElement(p.b,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"cd110359"},s.createElement(p.b,null,t),s.createElement(p.b,null,r)))(m,E,_):d&&d.animated_gif?e?((e,t,r,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"e70dcc35"},s.createElement(p.b,null,r),s.createElement(p.b,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"g1bf440b"},s.createElement(p.b,null,t),s.createElement(p.b,null,r),s.createElement(p.b,null,a)))(m,E,u,_):((e,t,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"b2da1bf8"},s.createElement(p.b,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"g84c0421"},s.createElement(p.b,null,t),s.createElement(p.b,null,r)))(m,E,_):d&&d.card?e?((e,t,r,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"cd2e7c18"},s.createElement(p.b,null,r),s.createElement(p.b,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"aee9e7fa"},s.createElement(p.b,null,t),s.createElement(p.b,null,r),s.createElement(p.b,null,a)))(m,E,u,_):((e,t,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"f9fb1cf6"},s.createElement(p.b,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"f2bf910e"},s.createElement(p.b,null,t),s.createElement(p.b,null,r)))(m,E,_):h?e?((e,t,r,a,n)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"i6cec545"},s.createElement(p.b,null,a),s.createElement(p.b,null,r),s.createElement(p.b,null,n)):s.createElement(b.a.I18NFormatMessage,{$i18n:"d6998baa"},s.createElement(p.b,null,t),s.createElement(p.b,null,a),s.createElement(p.b,null,r),s.createElement(p.b,null,n)))(m,E,_,u,h):((e,t,r,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"cec676f3"},s.createElement(p.b,null,r),s.createElement(p.b,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"a2706f9a"},s.createElement(p.b,null,t),s.createElement(p.b,null,r),s.createElement(p.b,null,a)))(m,E,_,h):((e,t,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"d6b15bbf"},s.createElement(p.b,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"ac0d4bc7"},s.createElement(p.b,null,t),s.createElement(p.b,null,r)))(m,E,_),s.createElement(p.b,{color:"gray700",numberOfLines:1},g)})),ce=r("H4nC"),le=r("b9JY");const de=b.a.fb3ccb55;var he=({conversationType:e,entry:t,perspective:r})=>{if(t.marked_as_spam)return s.createElement(p.b,{color:"gray700",numberOfLines:1},de);if(Object(le.b)(t)){const{message_data:{recipient_id:a,sender_id:n}={}}=t;return s.createElement(ee,{entry:t,isGroupDM:e===v.CONVERSATION_TYPE.GROUP,perspective:r,recipientId:a,senderId:n})}return Object(le.c)(t)?s.createElement(ie,{isGroupDM:e===v.CONVERSATION_TYPE.GROUP,perspective:r,reactionEntry:t,senderId:t.sender_id}):Object(le.a)(t)?s.createElement(U,{entry:t,entryType:t.type,perspective:r}):Object(le.d)(t)?s.createElement(ce.a,{entry:t,isCompact:!0}):null},pe=r("Myq3"),ue=r("3wZR"),me=r("XnpN"),be=r("AQ79"),Ee="conversation",_e=r("u0B7"),ge=r("MWbm"),ye=r("Irs7"),ve=r("Znyr"),fe=r("0PHd"),Se=r("yrzJ"),Ie=r("Xrkv"),Ce=r("lHOd"),xe=r("efqG"),we=r("/yvb"),Re=r("GBcw"),Oe=r("htQn"),Te=r("5mJL"),De=r("rHpw"),Me=r("vMjK"),Le=r("pHkl"),He=r("aWyx"),Pe=r("5oT/"),Ne=r("Lsrn"),Ae=r("k/Ka");const Fe=(e={})=>Object(Ae.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[Ne.a.root,e.style],viewBox:"0 0 24 24"},s.createElement("g",null,s.createElement("path",{d:"M22.238 2.257c-.293-.293-.768-.293-1.06 0L2.52 20.917c-.293.292-.293.767 0 1.06.146.146.338.22.53.22s.384-.073.53-.22l18.658-18.66c.293-.293.293-.767 0-1.06zM2.986 17.82c.155 0 .312-.048.446-.148.112-.083 2.752-2.104 2.708-7.248-.02-2.16.643-3.98 1.913-5.266 1.093-1.107 2.577-1.72 4.18-1.727 1.325.006 2.562.42 3.578 1.195.137.104.297.153.455.153.227 0 .45-.102.598-.295.25-.33.188-.8-.142-1.052-1.278-.975-2.828-1.493-4.483-1.5h-.003c-2.008.008-3.87.78-5.248 2.173-1.536 1.551-2.368 3.8-2.348 6.332.037 4.33-2.02 5.967-2.103 6.03-.332.247-.4.718-.154 1.05.147.2.374.303.603.303zm16.844-7.382c.002-.246-.003-.487-.017-.723-.024-.414-.387-.74-.792-.706-.413.023-.728.378-.705.79.012.205.017.413.015.624-.024 2.868.785 4.765 1.526 5.896h-8.314c-.414 0-.75.336-.75.75s.336.75.75.75h3.522c-.1 1.48-1.323 2.66-2.828 2.66-1.003 0-1.913-.514-2.436-1.372-.214-.354-.675-.467-1.03-.25-.354.214-.467.675-.25 1.03.795 1.31 2.185 2.09 3.716 2.09 2.332 0 4.227-1.85 4.328-4.158h4.922c.32 0 .604-.206.707-.51.104-.305 0-.643-.255-.84-.087-.066-2.145-1.7-2.108-6.032z"})));Fe.metadata={width:24,height:24};var ke=Fe;const Be=b.a.d88d0790,je={component:"low_quality_timeline"},Ue=({children:e})=>s.createElement(ge.a,{style:Ve.socialProofContainer},e);class Ge extends s.Component{constructor(...e){super(...e),n()(this,"state",{showConfirmation:!1}),n()(this,"_renderConversationEndCell",(()=>{const e=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_inbox_p0_enabled"),t=this.props.unread?s.createElement(ve.a,{pip:!0,style:Ve.unreadMessagePip,truncatedCountFormatter:()=>"",unreadCountLabel:()=>""}):null;switch(this.props.inboxType){case be.c.PRIMARY:return e?t:this._renderTimestamp();case be.c.SECONDARY:case be.c.TERTIARY:return this._renderX();default:return null}})),n()(this,"_renderConversationLabel",(({convo_label:e})=>{if(null==e||!e.text)return null;const t=Object(ue.b)(e.icon);return s.createElement(p.b,{color:"gray700",size:"subtext2"},t?s.createElement(t,{style:Ve.convoLabelIcon}):null,e.text)})),n()(this,"_renderSocialProof",(({social_proof:e},t)=>{if(!e||0===e.length)return null;const r=e[0];switch(r.proof_type){case He.d.MUTUAL_FRIENDS:{if(0===r.total)return null;const e=r.users.map((({profile_image_url_https:e})=>e)),a=r.users.map((({name:e})=>e)),n=t?{marginLeft:0}:null;return s.createElement(Ue,null,s.createElement(fe.a,{displayFacepileInline:!0,knownFollowersAvatarUrls:e,knownFollowersCount:r.total,knownFollowersNames:a,textStyle:n,withFacepile:!t}))}default:return null}})),n()(this,"_renderSearchConversationPreview",(()=>{const{conversation:e,perspective:t,searchQuery:r}=this.props,a=e?Object(me.a)(e,t):[],n=[],o=(e,t)=>e.localeCompare(t),i=a.map((({user:e})=>e)).filter((e=>{var a;const s=null===(a=e.name)||void 0===a?void 0:a.toLowerCase().includes(r);return e.id_str!==t&&(s&&n.push(e.name),!s)})).map((e=>e.name)).sort(o),c=n.sort(o).concat(i);if(e){if(e.type===v.CONVERSATION_TYPE.ONE_TO_ONE){const[e]=a.map((({user:e})=>e));return s.createElement(Se.a,{color:"gray700",screenName:e.screen_name})}{const e=!0,t=Object(Ie.a)(c,e);return s.createElement(p.b,{color:"gray700",numberOfLines:2},t)}}})),n()(this,"_renderX",(()=>{const{conversation:e,conversationId:t}=this.props,{loggedInUserId:r}=this.context,a=Object(q.i)(e,r),n=(null==e?void 0:e.type)===v.CONVERSATION_TYPE.GROUP;return s.createElement(Ce.a.Consumer,null,(e=>s.createElement(xe.a,{renderContent:(r,o)=>s.createElement(x.a,{dismiss:r,flatBorders:"sheet"===o,isGroup:n,onBlockClick:this._blockUser(a.idStr),onDeleteClick:this._deleteConversation(t),onReportClick:this._handleReportMenuItemClick(e),requestorScreenName:a.screenName,showBlock:!n,showCancel:"sheet"===o,showDelete:!0})},s.createElement(we.a,{accessibilityLabel:Be,icon:s.createElement(Pe.a,null),onPress:this._handleXPress,style:Ve.xButton,type:"destructiveText"}))))})),n()(this,"_handleXPress",(e=>{e.preventDefault()})),n()(this,"_handleReportMenuItemClick",(e=>()=>{const{analytics:t,conversationId:r,inboxType:a}=this.props;if(r){t.scribeAction("report");const n=Object(q.f)(r,window.location.pathname,t.contextualScribeNamespace,a);e.push(n)}})),n()(this,"_renderTimestamp",(()=>{const{conversation:e}=this.props,t=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_inbox_p0_enabled"),r=[t?Ve.inlineNotificationsDisabledIcon:Ve.notificationsDisabledIcon];return s.createElement(s.Fragment,null,s.createElement(ge.a,{style:t&&Ve.inlineTimestamp},e?s.createElement(Re.a,{timestamp:Number(e.sort_timestamp)}):null,null!=e&&e.notifications_disabled?s.createElement(ke,{style:r}):null))})),n()(this,"_deleteConversation",(e=>()=>{const{analytics:t,conversation:r,createLocalApiErrorHandler:a,inboxType:n,leaveConversation:s,position:o}=this.props,{history:i}=this.context,c=null!=r&&r.participants?Object.keys(r.participants).length:0,l=r&&r.type===v.CONVERSATION_TYPE.GROUP?"leave_group":"delete_thread",d={conversation_type:(null==r?void 0:r.type)===v.CONVERSATION_TYPE.GROUP?1:0,conversation_id:e,conversation_participant_count:c,position:o,inbox_type:Object(q.h)(n),entry_point:Le.b.CELL_X_BUTTON};this._handleHideConfirmation(),t.scribe({element:"thread",action:l,data:d}),s({conversationId:e}).catch(a({showToast:!0})),i.replace(Object(q.e)(n))})),n()(this,"_blockUser",(e=>()=>{const{addToast:t,analytics:r,block:a,createLocalApiErrorHandler:n}=this.props;a(e).then((()=>{t({action:{label:Me.c,onAction:this._createUnblockUserHandler(e)},text:Me.a})}),n(C.a)),r.scribeAction("block")})),n()(this,"_createUnblockUserHandler",(e=>()=>{const{analytics:t,createLocalApiErrorHandler:r,unblock:a}=this.props;a(e).catch(r(_e.a)),t.scribeAction("unblock")})),n()(this,"_handleHideConfirmation",(()=>{this.setState({showConfirmation:!1})})),n()(this,"_handleOnClick",(e=>{const{addRecentSearch:t,analytics:r,conversation:a,conversationId:n,onClick:s,position:o,searchQuery:i}=this.props,c=this.context.featureSwitches.isTrue("responsive_web_dm_server_side_search"),l=null!=a&&a.participants?Object.keys(a.participants).length:0,d=(null==a?void 0:a.type)===v.CONVERSATION_TYPE.GROUP;i&&c&&(r.scribe({component:"search",element:"conversation",action:"click",data:{conversation_id:n,conversation_participant_count:l,conversation_type:d?Le.g.GROUP:Le.g.ONE_TO_ONE,entry_point:Le.b.ALL,inbox_type:Le.c.PRIMARY,dm_search_result_type:Le.a.CONVERSATION,message_type:Le.d.NOT_APPLICABLE,position:o}}),r.scribe({component:"recent_search",action:"add"}),t(i)),s(e,n,a,o)})),n()(this,"_handleShowConfirmation",(e=>{const{analytics:t}=this.props;e.stopPropagation(),t.scribe({...je,element:"accessory_trashcan",action:"click"}),this.setState({showConfirmation:!0})}))}shouldComponentUpdate(e,t){const r=this.props.conversation,a=null==r?void 0:r.conversation_id,n=null==r?void 0:r.last_read_event_id,s=null==r?void 0:r.sort_event_id,o=null==r?void 0:r.max_entry_id,i=null==r?void 0:r.convo_label,c=e.conversation,l=null==c?void 0:c.conversation_id,d=null==c?void 0:c.last_read_event_id,h=null==c?void 0:c.sort_event_id,p=null==c?void 0:c.max_entry_id,u=null==c?void 0:c.convo_label,{filter:m,isActive:b}=this.props,{filter:E,isActive:_}=e,{showConfirmation:g}=this.state,{showConfirmation:y}=t;return a!==l||n!==d||s!==h||o!==p||b!==_||g!==y||m!==E||i!==u}render(){const{conversation:e,filter:t,isActive:r,link:a,perspective:n,position:o,searchQuery:i,unread:c}=this.props,l=(null==e?void 0:e.entries)||[],d=Object(pe.a)(l,(e=>![He.b.MESSAGE_DELETE,He.b.REACTION_DELETE,He.b.MESSAGE_MARK_AS_SPAM,He.b.MESSAGE_MARK_AS_NOT_SPAM,He.b.CONVO_METADATA_UPDATE].includes(e.type))),h=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_inbox_p0_enabled"),p=[Ve.root,c&&!h&&Ve.unread],u=this.context.featureSwitches.isTrue("responsive_web_dm_server_side_search"),m=e&&t&&t(e),b=(null==e?void 0:e.type)===v.CONVERSATION_TYPE.GROUP,E=h&&b;if(!e||!m&&!u)return null;const _=!!e.convo_label,g=!e.trusted&&!_,y=h?"xxxLarge":"xxLarge",f=this._renderConversationEndCell();return!e||!m&&!u||!i&&e.isSearchResultOnly?null:s.createElement(Oe.a,{accessibilityRole:"tab",accessibilityState:{selected:r},link:{pathname:a,anchorless:!0,state:{position:o}},onPress:this._handleOnClick,style:p,testID:Ee},s.createElement(Te.a,{avatarCell:s.createElement(N.a,{conversation:e,perspective:n,withBadge:E,withVDLRefresh:h}),avatarSize:y},s.createElement(ge.a,{style:Ve.bodyColumn},s.createElement(ge.a,{style:Ve.titleContainer},s.createElement(A.b,{conversation:e,isSearchTitle:!!i&&u,perspective:n,renderTimestamp:this._renderTimestamp,withScreenName:!i,withVDLRefresh:h}),s.createElement(ge.a,{style:Ve.snippet},!d||u&&i?u&&i?this._renderSearchConversationPreview():null:s.createElement(he,{conversationType:e.type,entry:d,perspective:n})),_?this._renderConversationLabel(e):null,g?this._renderSocialProof(e,h):null),f?s.createElement(ge.a,{style:Ve.endCell},f):null)))}}n()(Ge,"contextType",i.a),n()(Ge,"defaultProps",{searchQuery:"",inboxType:"primary",isActive:!1,filter:e=>!0});const Ve=De.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.spaces.space16,width:"100%"},bodyColumn:{flexDirection:"row"},inlineTimestamp:{flexDirection:"row"},titleContainer:{flex:1},inlineNotificationsDisabledIcon:{paddingLeft:`calc(${e.spaces.space2} * 3)`,color:e.colors.gray700},notificationsDisabledIcon:{alignSelf:"flex-end",color:e.colors.gray700,paddingTop:e.spaces.space4},unreadMessagePip:{backgroundColor:e.colors.blue500,marginTop:"7px"},xButton:{alignSelf:"center",marginRight:`calc(-1 * ${e.spaces.space4})`},xIcon:{color:e.colors.magenta500},trashcanIcon:{color:e.colors.gray700},snippet:{maxHeight:e.spaces.space40,overflow:"hidden"},unread:{backgroundColor:e.colors.unreadCellBackground},socialProofContainer:{marginTop:e.spaces.space4},convoLabelIcon:{marginRight:e.spaces.space4},endCell:{marginLeft:e.spaces.space16}})));var qe=Object(ye.a)(P(Ge),{page:"messages",section:"inbox"});const Qe=(e,{module:t})=>t.selectItems(e),We=(e,{module:t})=>t.selectItems(e).map((t=>v.selectConversation(e,t))),ze=(e,{module:t})=>t.selectFetchStatus(e);var $e=Object(l.a)().propsFromState((()=>({conversations:We,fetchStatus:ze,sliceItems:Qe}))).adjustStateProps((({conversations:e,fetchStatus:t,sliceItems:r})=>({fetchStatus:t,groupConversationIds:e.filter((e=>(null==e?void 0:e.data)&&e.data.type===He.a.GROUP)).map((e=>{var t;return null==e||null===(t=e.data)||void 0===t?void 0:t.conversation_id})),oneToOneConversationIds:(e=>e.filter((e=>(null==e?void 0:e.data)&&e.data.type===He.a.ONE_TO_ONE)).map((e=>{var t;return null==e||null===(t=e.data)||void 0===t?void 0:t.conversation_id})))(e),sliceItems:r}))).propsFromActions((({module:e})=>({createLocalApiErrorHandler:Object(S.createLocalApiErrorHandlerWithContextFactory)("DM_SEARCH_ALL_CONTEXT"),fetchSearchIfNeeded:e.fetchIfNeeded})));const Ke=b.a.b08821f3,Xe=b.a.e047b8fa,Ye=De.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,paddingLeft:e.spaces.space16,paddingVertical:e.spaces.space4,alignItems:"center",flexDirection:"row",justifyContent:"space-between",borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor},backButton:{marginRight:e.spaces.space4},iconContainer:{alignItems:"center",flexDirection:"row"},icon:{color:e.colors.text,marginRight:e.spaces.space12,fontSize:e.fontSizes.body,marginVertical:e.spaces.space8},labelHeader:{borderBottomStyle:"none",paddingVertical:e.spaces.space12}})));var Ze=e=>{const t=Object(ye.b)(),{clearRecentSearches:r,headerText:a,icon:n,isInboxLabelHeader:o,withClearButton:i}=e;s.useEffect((()=>{t.scribe({component:"recent_search",action:"impression"})}),[t]);const c=[Ye.root,o&&Ye.labelHeader];return s.createElement(ge.a,{style:c},s.createElement(ge.a,{style:Ye.iconContainer},(()=>{const e=n;return e?s.createElement(e,{style:Ye.icon}):null})(),s.createElement(p.b,{size:"headline1",weight:"heavy"},a)),i?s.createElement(we.a,{accessibilityLabel:Ke,onPress:r,style:Ye.backButton,type:"onMediaWhiteFilled"},Xe):null)},Je=r("MDbM"),et=r("v//M"),tt=r("0yYu"),rt=r("lBmi"),at=r("6ZHn");const nt=b.a.g2fd3205,st=b.a.c94ac69d,ot=b.a.ffd9cfe6;class it extends s.Component{constructor(...e){super(...e),n()(this,"_groupBucketSize",this.context.featureSwitches.getNumberValue("dm_inbox_search_groups_bucket_size")),n()(this,"_peopleBucketSize",this.context.featureSwitches.getNumberValue("dm_inbox_search_people_bucket_size")),n()(this,"_renderSearchResults",(()=>{const{groupConversationIds:e,oneToOneConversationIds:t,renderEmptyState:r,sliceItems:a}=this.props,n=t.length&&e.length,o=this._groupBucketSize<e.length,i=this._peopleBucketSize<t.length;return a.length?s.createElement(s.Fragment,null,t.length?this._renderPeopleSection():null,n&&!i?s.createElement(tt.a,null):null,i?this._renderDMSearchFooter("People"):null,e.length?this._renderGroupsSection():null,o?this._renderDMSearchFooter("Groups"):null):r()})),n()(this,"_handleFetch",(()=>{const{createLocalApiErrorHandler:e,fetchSearchIfNeeded:t}=this.props;t().catch(e())})),n()(this,"_renderDMSearchFooter",(e=>{const{location:t}=this.props;return s.createElement(ge.a,{style:ct.header},s.createElement(p.b,{link:{pathname:t.pathname,state:{tab:e}}},ot))})),n()(this,"_renderDMHeader",(({headerText:e,icon:t})=>s.createElement(Ze,{headerText:e,icon:t}))),n()(this,"_renderGroupsSection",(()=>{const{groupConversationIds:e,query:t,renderInboxItem:r,sliceItems:a}=this.props;return s.createElement(s.Fragment,null,this._renderDMHeader({icon:rt.a,headerText:st}),e.map((e=>e?r(t,a)(e):null)).slice(0,this._groupBucketSize))})),n()(this,"_renderPeopleSection",(()=>{const{oneToOneConversationIds:e,query:t,renderInboxItem:r,sliceItems:a}=this.props;return s.createElement(s.Fragment,null,this._renderDMHeader({icon:at.a,headerText:nt}),e.map((e=>e?r(t,a)(e):null)).slice(0,this._peopleBucketSize))}))}componentDidUpdate(e){const{fetchStatus:t,module:r}=this.props;e.module!==r&&t!==Je.a.FAILED&&this._handleFetch()}componentDidMount(){this._handleFetch()}render(){const{fetchStatus:e,loadingLabel:t}=this.props;return s.createElement(et.a,{accessibilityLabel:t,fetchStatus:e,onRequestRetry:this._handleFetch,render:this._renderSearchResults})}}n()(it,"contextType",i.a);const ct=De.a.create((e=>({header:{backgroundColor:e.colors.cellBackground,paddingLeft:e.spaces.space16,paddingVertical:e.spaces.space12,alignItems:"center",flexDirection:"row",justifyContent:"space-between",borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor,borderTopStyle:"solid",borderTopWidth:e.borderWidths.small,borderTopColor:e.colors.borderColor}})));var lt=$e(it),dt=r("wAC9"),ht=r("xPna");const pt=e=>{const t={};return e&&e.conversations&&Object.values(e.conversations).forEach((e=>{e&&e.users&&Object.assign(t,e.users)})),Object(ht.a)({conversations:null==e?void 0:e.conversations,users:t})};var ut=e=>Object(dt.a)({contextSuffix:"DM_SEARCH_SLICE",getFetchApiEndpoint:e=>e.DirectMessagesGraphQL.fetchDMAllSearch,sliceKey:`${Le.e}-${e}`,getEndpointParams:t=>({...t,query:e}),mapEntitiesToActions:pt});const mt=(e,t)=>t.query;var bt=Object(l.a)().propsFromState((()=>({sliceModule:Object(R.createSelector)(mt,(e=>e?ut(e):void 0))})))((e=>{const{loadingLabel:t,location:r,query:a,renderEmptyState:n,renderInboxItem:o,sliceModule:i}=e;return i?s.createElement(lt,{loadingLabel:t,location:r,module:i,query:a,renderEmptyState:n,renderInboxItem:o}):n()}));const Et=v.selectRecentSearches,_t=(e,t)=>t.query?v.selectSearchConversations(e,t.query):[],gt=(e,t)=>t.query?v.selectSearchFetchStatus(e,t.query):f.a.LOADED,yt=(e,t)=>t.conversationIds||[],vt=(e,t)=>null!=e&&e.length?t.filter((t=>e.indexOf(t)>-1)):e;var ft=Object(l.a)().propsFromState((()=>({conversationIds:yt,recentSearches:Et,searchFetchStatus:gt,searchConversationIds:_t}))).adjustStateProps((({conversationIds:e,recentSearches:t,searchConversationIds:r,searchFetchStatus:a})=>({conversationIds:e,recentSearches:t,searchFetchStatus:a,searchConversationIds:vt(r,e)}))).propsFromActions((()=>({addRecentSearch:v.addRecentSearches,createLocalApiErrorHandler:Object(S.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_SEARCH"),search:v.searchConversations,clearRecentSearch:v.clearRecentSearch,clearRecentSearches:v.clearRecentSearches}))),St=r("VY6S"),It=r("s14A"),Ct=r("j7Bv"),xt=r("VwDm"),wt=r("hOZg");const Rt=b.a.dbd5d40f;class Ot extends s.PureComponent{render(){const{clearRecentSearch:e,handleRecentSearchClick:t,recentSearch:r}=this.props,a=s.createElement(Ct.a,{Icon:xt.a,color:"neutral",size:"xLarge",style:Tt.searchIcon}),n=[Tt.listItemView,Tt.bottomBorder];return s.createElement(Oe.a,{onPress:t,style:n},s.createElement(ge.a,null,s.createElement(Te.a,{avatarCell:a,avatarSize:"xLarge",cellStyle:Tt.avatarColumn},s.createElement(ge.a,{style:Tt.container},s.createElement(p.b,{numberOfLines:1},r),s.createElement(we.a,{accessibilityLabel:Rt,borderColor:"transparent",icon:s.createElement(wt.a,null),onPress:e,type:"brandText"})))))}}const Tt=De.a.create((e=>({container:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},searchIcon:{marginRight:e.spaces.space12,padding:e.spaces.space4},avatarColumn:{flexGrow:1,minWidth:"32px"},bottomBorder:{borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor},listItemView:{backgroundColor:e.colors.cellBackground,paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.spaces.space12,width:"100%"}})));var Dt=Ot;var Mt=e=>Object(dt.a)({contextSuffix:"DM_GROUP_SEARCH_SLICE",getFetchApiEndpoint:e=>e.DirectMessagesGraphQL.fetchDMGroupSearch,sliceKey:`${Le.e}-groups-${e}`,getEndpointParams:t=>({...t,query:e}),mapEntitiesToActions:pt});var Lt=e=>Object(dt.a)({contextSuffix:"DM_PEOPLE_SEARCH_SLICE",getFetchApiEndpoint:e=>e.DirectMessagesGraphQL.fetchDMPeopleSearch,sliceKey:`${Le.e}-people-${e}`,getEndpointParams:t=>({...t,query:e}),mapEntitiesToActions:pt});const Ht=(e,t)=>t.query,Pt=(e,t)=>t.tabType;var Nt=Object(l.a)().propsFromState((()=>({sliceModule:Object(R.createSelector)(Pt,Ht,((e,t)=>{const r=t&&e===Le.f.PEOPLE;return t&&e===Le.f.GROUPS?Mt(t):r?Lt(t):void 0}))}))),At=r("FS1z");var Ft=Nt((e=>{const{footer:t,onScrollEnd:r,query:a,renderEmptyState:n,renderInboxItem:o,sliceModule:i}=e;return i?s.createElement(At.a,{footer:t,module:i,noItemsRenderer:n,onScrollEnd:r,renderer:o(a,[]),withoutHeadroom:!0}):n()})),kt=r("VPAj");var Bt={...r("7n04").a,initialScrollHeadroom:Object(kt.a)(0),scrollHeadroom:Object(kt.a)(0),pinToNewestWhenAtNewest:!0},jt=r("TEoO"),Ut=r("IG4P"),Gt=r("RJrc"),Vt=r("TnY3"),qt=r("FIs5"),Qt=r("cm6r"),Wt=r("6OUF"),zt=r("k/OQ"),$t=r("95Se");const Kt=e=>e,Xt=b.a.b08821f3,Yt=b.a.a66ac766,Zt=b.a.fe61929d,Jt=b.a.b9dae4f4,er=b.a.e7fb2027,tr=b.a.b92a21d8,rr=b.a.jdc67c42,ar=b.a.f08940ab,nr=b.a.gaae1fd5,sr=b.a.f8321d82,or=b.a.g2fd3205,ir=b.a.c94ac69d,cr=b.a.fb3c8e74;class lr extends s.Component{constructor(...e){super(...e),n()(this,"state",{debouncedQuery:"",isLoadingMore:!1,isRefreshing:!1}),n()(this,"_modularSearchEnabled",this.context.featureSwitches.isTrue("dm_inbox_search_modular_results_enabled")),n()(this,"_setInputRef",(e=>{this._textInputRef=e})),n()(this,"_renderEmptyDMSearchInbox",(()=>{const{analytics:e,query:t}=this.props,{debouncedQuery:r}=this.state;return r&&t?(e.scribe({component:"search",element:"results",action:"empty"}),s.createElement(qt.a,{buttonLink:"/messages/compose",buttonText:ar,header:tr({query:r}),message:rr,onButtonPress:this._handleComposeButtonPress})):s.createElement(ge.a,{style:dr.emptyState},s.createElement(p.b,{align:"center",color:"gray700"},nr))})),n()(this,"_renderRecentSearches",(()=>{const{analytics:e,query:t,recentSearches:r}=this.props;return r.length&&!t?s.createElement(s.Fragment,null,s.createElement(Ze,{analytics:e,clearRecentSearches:this._clearRecentSearches,headerText:cr,withClearButton:!0}),r.map((e=>s.createElement(Dt,{clearRecentSearch:t=>this._handleClearRecentSearch(t,e),handleRecentSearchClick:()=>this._handleRecentSearchClick(e),key:e,recentSearch:e})))):this._renderEmptyDMSearchInbox()})),n()(this,"_renderAllDMSearchResultsTab",(()=>{const{location:e,renderInboxItem:t}=this.props,{debouncedQuery:r}=this.state;return r?s.createElement(bt,{loadingLabel:Yt,location:e,query:r,renderEmptyState:this._renderEmptyDMSearchInbox,renderInboxItem:t}):this._renderEmptyDMSearchInbox()})),n()(this,"_renderGroupsTab",(()=>{const{renderInboxItem:e}=this.props,{debouncedQuery:t}=this.state;return s.createElement(Ft,{footer:this._renderFooter(),onScrollEnd:this._handleScrollEnd,query:t,renderEmptyState:this._renderEmptyDMSearchInbox,renderInboxItem:e,tabType:Le.f.GROUPS})})),n()(this,"_renderPeopleTab",(()=>{const{renderInboxItem:e}=this.props,{debouncedQuery:t}=this.state;return s.createElement(Ft,{footer:this._renderFooter(),onScrollEnd:this._handleScrollEnd,query:t,renderEmptyState:this._renderEmptyDMSearchInbox,renderInboxItem:e,tabType:Le.f.PEOPLE})})),n()(this,"_renderTabContent",(()=>{const{location:e}=this.props,{tab:t}=(null==e?void 0:e.state)||{};return t===or?this._renderPeopleTab():t===ir?this._renderGroupsTab():this._renderAllDMSearchResultsTab()})),n()(this,"_renderSearchResults",(()=>{const{accessibilityTitle:e,renderInboxItem:t,searchConversationIds:r}=this.props,{debouncedQuery:a,isRefreshing:n}=this.state;return s.createElement(It.a,null,s.createElement(Ut.a,{isRefreshing:n,onRefresh:this._handlePullToRefresh},s.createElement(jt.a,{accessibilityRole:"tablist",accessibilityTitle:e,anchoring:Bt,assumedItemHeight:100,cacheKey:"dmSearchInbox",footer:this._renderFooter(),identityFunction:Kt,items:r,noItemsRenderer:this._renderRecentSearches,onNearEnd:this._handleNearEnd,onScrollEnd:this._handleScrollEnd,renderer:t(a,r),withoutHeadroom:!0})))})),n()(this,"_renderFooter",(()=>this.state.isLoadingMore?s.createElement(Gt.a,null):s.createElement(ge.a,{style:dr.footerContainer},s.createElement(p.b,{align:"center",size:"body",weight:"bold"},er),s.createElement(Qt.a,{interactiveStyles:null},s.createElement(p.b,{align:"center",color:"primary",onPress:this._handleFooterClick,size:"subtext2",withInteractiveStyling:!0},Jt))))),n()(this,"_clearRecentSearches",(()=>{const{analytics:e,clearRecentSearches:t}=this.props;e.scribe({component:"recent_search",action:"clear"}),t()})),n()(this,"_handleComposeButtonPress",(()=>{const{analytics:e}=this.props;e.scribe({component:"search",element:"empty_results",action:"compose"})})),n()(this,"_handleFooterClick",(()=>{var e,t,r;this._textInputRef&&this._textInputRef.focus(),null===(e=this._textInputRef)||void 0===e||null===(t=e.textInput)||void 0===t||null===(r=t.textInputNode)||void 0===r||r.select()})),n()(this,"_handleRefetchSearch",(()=>{const{analytics:e,createLocalApiErrorHandler:t,search:r}=this.props,{debouncedQuery:a}=this.state;r&&a&&(e.scribe({component:"search",element:"retry",action:"click"}),r({query:a.toLowerCase(),preserveResults:!1,fetchNextPage:!1}).catch(t()))})),n()(this,"_handlePullToRefresh",(()=>{const{createLocalApiErrorHandler:e,search:t}=this.props,{debouncedQuery:r}=this.state;this.setState({isRefreshing:!0}),t&&r&&t({query:r.toLowerCase(),preserveResults:!0,fetchNextPage:!1}).then((()=>this.setState({isRefreshing:!1}))).catch((t=>(this.setState({isRefreshing:!1}),e()(t))))})),n()(this,"_handleSearchChangeInner",(e=>{const{createLocalApiErrorHandler:t,onQueryChange:r,search:a}=this.props;r(e),this.setState({debouncedQuery:e}),a&&e&&!this._modularSearchEnabled&&a({query:e,preserveResults:!1,fetchNextPage:!1}).catch(t())})),n()(this,"_handleSearchChangeDebounced",Object(St.a)(this._handleSearchChangeInner,200)),n()(this,"_handleSearchChange",(({currentTarget:{value:e}})=>{const{onQueryChange:t}=this.props;(e&&e.trim()||!e)&&(t(e),this._handleSearchChangeDebounced(e))})),n()(this,"_handleNearEnd",(()=>{const{analytics:e,search:t}=this.props,{debouncedQuery:r}=this.state;this.setState({isLoadingMore:!0}),r&&(e.scribe({component:"search",element:"results",action:"get_older"}),t({query:r,preserveResults:!1,fetchNextPage:!0}).finally((()=>this.setState({isLoadingMore:!1}))))})),n()(this,"_handleScrollEnd",(()=>{const{addRecentSearch:e,analytics:t,query:r}=this.props,{debouncedQuery:a}=this.state;a&&r&&(e(r),t.scribe({component:"recent_search",action:"add"}))})),n()(this,"_handleSearchClear",(()=>this._handleSearchChangeInner(""))),n()(this,"_handleHideRecentSearches",(()=>{const{hideRecentSearches:e}=this.props;e()})),n()(this,"_handleAddRecentSearch",(({currentTarget:{value:e}})=>{const{addRecentSearch:t,analytics:r}=this.props;e&&(t(e),r.scribe({component:"recent_search",action:"add"}),this._textInputRef&&this._textInputRef.blur())})),n()(this,"_handleRecentSearchClick",(e=>{const{analytics:t,onQueryChange:r}=this.props;r(e),t.scribe({component:"recent_search",action:"click"}),this._handleSearchChangeInner(e)})),n()(this,"_handleClearRecentSearch",((e,t)=>{const{analytics:r,clearRecentSearch:a}=this.props;e.stopPropagation(),e.preventDefault(),r.scribe({component:"recent_search",action:"clear"}),a(t)}))}componentDidMount(){this._textInputRef&&this._textInputRef.focus()}componentDidUpdate(e){const{analytics:t,query:r,recentSearches:a}=this.props;e.query||!r||a.includes(r)||t.scribe({component:"search",action:"began_typing"})}render(){const{location:e,query:t,searchFetchStatus:r}=this.props,a=!(this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_inbox_p0_enabled")||this._modularSearchEnabled&&t),n=[dr.searchInput,a?dr.searchInputBorder:void 0],{tab:o}=(null==e?void 0:e.state)||{},i=[sr,or,ir].map((t=>({key:t,label:t,isActive:()=>o===t||!o&&t===sr,to:{...e,state:{...e.state,tab:t}}})));return s.createElement(s.Fragment,null,s.createElement(ge.a,{style:n},s.createElement(we.a,{accessibilityLabel:Xt,icon:s.createElement($t.a,null),onPress:this._handleHideRecentSearches,pullLeft:!0,type:"primaryText"}),s.createElement(Wt.a,{Icon:xt.a,autoComplete:"off",onChange:this._handleSearchChange,onClear:this._handleSearchClear,onSubmitEditing:this._handleAddRecentSearch,placeholder:Zt,ref:this._setInputRef,value:t,withClearButton:!0})),this._modularSearchEnabled&&(t||o===or||o===ir)?s.createElement(s.Fragment,null,s.createElement(zt.a,{links:i}),this._renderTabContent()):s.createElement(et.a,{accessibilityLabel:Yt,fetchStatus:r,onRequestRetry:this._handleRefetchSearch,render:this._renderSearchResults}))}}n()(lr,"contextType",i.a),n()(lr,"defaultProps",{recentSearches:[],searchConversationIds:[],query:""});const dr=De.a.create((e=>({emptyState:{marginTop:e.spaces.space32},searchInput:{backgroundColor:e.colors.cellBackground,padding:e.spaces.space12,flexDirection:"row",alignItems:"center",zIndex:1},searchInputBorder:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small},footerContainer:{marginVertical:e.spaces.space32}})));var hr=Object(Vt.a)(ft(lr)),pr=r("dwig"),ur=r("QB0K"),mr=r("Avzu"),br=r("FRNI");const Er=b.a.h845f281,_r=b.a.f325afc3;class gr extends s.PureComponent{render(){return s.createElement(ur.a,{accessibilityLabel:Er,href:"/messages/compose",icon:s.createElement(mr.a,null),label:Er,scribeComponent:"floating_dm_button",shortLabel:_r,testID:br.a.message})}}var yr=gr,vr=r("tI3i"),fr=r.n(vr),Sr=r("883S"),Ir=r("yoO3"),Cr=r("GSsg"),xr=r("2g+p"),wr=r("mw9i"),Rr=r("BcsE"),Or=r("+d3d");const Tr=e=>e,Dr=b.a.a66ac766,Mr=b.a.fe61929d;class Lr extends s.Component{constructor(e,t){super(e,t),n()(this,"state",{filterQuery:"",showRecentSearches:!1,searchQuery:""}),n()(this,"_render",(()=>{const{showRecentSearches:e}=this.state;return this._isServerSearchEnabled&&e?this._renderFocusedSearch():this._renderInbox()})),n()(this,"_renderFocusedSearch",(()=>{const{accessibilityTitle:e,analytics:t,conversationIds:r,renderStickyContent:a}=this.props,{searchQuery:n}=this.state;return s.createElement(s.Fragment,null,a?a():null,s.createElement(hr,{accessibilityTitle:e,analytics:t,conversationIds:r,hideRecentSearches:this._hideRecentSearches,onQueryChange:this._handleQueryChange,query:n,renderInboxItem:this._renderInboxItem}))})),n()(this,"_renderInbox",(()=>{const{accessibilityTitle:e,conversationIds:t,footer:r,isDrawer:a,isRefreshing:n,renderEmptyDMInbox:o,renderStickyContent:i,virtualScrollerCacheKey:c}=this.props,l=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_inbox_p0_enabled"),d=[Hr.searchInput,l?void 0:Hr.searchInputBorder],h=s.createElement(s.Fragment,null,i?i():null,this._enableSearchInbox?s.createElement(ge.a,{onClick:this._isServerSearchEnabled?this._handleSearchClick:void 0,style:d},s.createElement(Wt.a,{Icon:xt.a,autoComplete:"off",onChange:this._handleSearchChange,onClear:this._handleSearchClear,onFocus:this._handleSearchFocus,placeholder:Mr,withClearButton:!0})):null);return s.createElement(Ut.a,{isRefreshing:n,onRefresh:this._handlePullToRefresh},c&&t?s.createElement(jt.a,{accessibilityRole:"tablist",accessibilityTitle:e,anchoring:Bt,assumedItemHeight:100,cacheKey:c,footer:r,header:h,identityFunction:Tr,items:t,noItemsRenderer:o,onNearEnd:this._handleNearEnd,renderer:this._renderInboxItem(this.state.filterQuery,t),withKeyboardShortcuts:!a,withoutHeadroom:!0}):null)})),n()(this,"_handleNearEnd",(()=>{const{filterQuery:e}=this.state;e||this._handleHistoryRequest()})),n()(this,"_handleQueryChange",(e=>{this.setState({searchQuery:e})})),n()(this,"_handleSearchChangeInner",(e=>{const{analytics:t}=this.props;this.setState({filterQuery:e.toLowerCase()}),t.scribe({element:"thread",action:"search",data:{event_value:this.state.filterQuery.length}})})),n()(this,"_handleSearchChangeDebounced",Object(St.a)(this._handleSearchChangeInner,200)),n()(this,"_handleSearchChange",(({currentTarget:{value:e}})=>{this.state.showRecentSearches||this.setState({showRecentSearches:!0}),(e&&e.trim()||!e)&&(this._handleQueryChange(e),this._handleSearchChangeDebounced(e))})),n()(this,"_handleSearchClear",(()=>this._handleSearchChangeInner(""))),n()(this,"_handleSearchFocus",(()=>{this.props.conversationIds&&this.props.conversationIds.length<30&&this._handleHistoryRequest()})),n()(this,"_handleSearchClick",(()=>{const{analytics:e}=this.props;e.scribe({component:"search",action:"click"}),this.setState({showRecentSearches:!0})})),n()(this,"_hideRecentSearches",(()=>{this.setState({showRecentSearches:!1,searchQuery:""})})),n()(this,"_renderInboxItem",((e,t)=>(e,r)=>{const{loggedInUserId:a}=this.context,{filterQuery:n,searchQuery:i}=this.state,c=this._filterConversation(n),l=`/messages/${e}`,d=e&&null!=t&&t.length?t.indexOf(e):null,h=Object(Rr.a)(d)?d+1:0;return fr()(!!a,"loggedInUserId must be defined"),r&&r(!0),s.createElement(o.a,{exact:!1,path:l},(t=>s.createElement(qe,{conversationId:e,currentQuery:n,filter:c,inboxType:this.props.inboxType,isActive:t,key:e,link:l,onClick:this._handleConversationClick,perspective:a,position:h,searchQuery:i})))})),n()(this,"_filterConversation",(e=>e=>{const{filterQuery:t}=this.state;if(!t)return!0;const{loggedInUserId:r}=this.context,a=Object.keys(e.participants),n="GROUP_DM"===e.type&&e.name&&e.name.toLowerCase().indexOf(t)>-1,s=a.some((n=>{const s=e.participants[n],o=r===n,i=1===a.length&&o,c=s&&s.user&&!o;return!(!i&&!c)&&this._userMatchesQuery(s.user.screen_name,s.user.name,t)}));return!(!n&&!s)})),n()(this,"_handleFetchInitialWrapper",(()=>{this._handleFetchInitial()})),n()(this,"_handleFetchInitial",(()=>{const{createLocalApiErrorHandler:e,fetchInboxIfNeeded:t,fetchUpdates:r}=this.props;return t().then(this._updateLastSeenEventId,e()).then((()=>{this._updatePolling.start()})).then((()=>r().catch(e())))})),n()(this,"_handleConversationClick",((e,t,r,a)=>{const{analytics:n,customCellClick:s}=this.props,o=null!=r&&r.participants?Object.keys(r.participants).length:0,i=(null==r?void 0:r.type)===v.CONVERSATION_TYPE.GROUP;n.scribe({element:"thread",action:"click",data:{event_value:this.state.filterQuery.length,conversation_id:t,conversation_participant_count:o,conversation_type:i?Le.g.GROUP:Le.g.ONE_TO_ONE,position:a}}),s&&s(e,t)})),n()(this,"_handleEmptyDMInboxImpression",(()=>{const{analytics:e}=this.props;e.scribe({component:"empty_message",action:"impression"})})),n()(this,"_handlePullToRefresh",(()=>{const{createLocalApiErrorHandler:e,fetchInbox:t}=this.props;t().then(this._updateLastSeenEventId,e())})),n()(this,"_updateLastSeenEventIdIfActive",(()=>{if("background"!==xr.a.currentState)return this._updateLastSeenEventId()})),n()(this,"_updateLastSeenEventId",(()=>{const{createLocalApiErrorHandler:e,updateLastSeenEventId:t}=this.props;return t().catch(e())})),this._fab=s.createElement(yr,null),this._enableSearchInbox=!!e.withDmSearch&&this.context.featureSwitches.isTrue("responsive_web_search_dms_enabled"),this._isServerSearchEnabled=this._enableSearchInbox&&this.context.featureSwitches.isTrue("responsive_web_dm_server_side_search")}componentDidMount(){const{createLocalApiErrorHandler:e,fetchInboxHistory:t,fetchUpdates:r}=this.props;return this._updatePolling=new Cr.a((()=>{r().then(this._updateLastSeenEventIdIfActive,e(Sr.a))}),{interval:8e3}),this._handleHistoryRequest=Object(Or.a)(((...r)=>{t(...r).catch(e())}),1e3),this._handleFetchInitial()}componentWillUnmount(){this._updatePolling.stop()}render(){return s.createElement(Ir.a,null,s.createElement(y,null),s.createElement(pr.a,{component:wr.a,fab:this._fab,style:Hr.root},s.createElement(et.a,{accessibilityLabel:Dr,fetchStatus:this.props.fetchStatus,onRequestRetry:this._handleFetchInitialWrapper,render:this._render})))}_userMatchesQuery(e,t,r){return e&&e.toLowerCase().indexOf(r)>-1||t&&t.toLowerCase().indexOf(r)>-1}}n()(Lr,"contextType",i.a),n()(Lr,"defaultProps",{conversationIds:[],inboxType:be.c.PRIMARY,isDrawer:!1,withDmSearch:!1});const Hr=De.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,flexGrow:1},searchInput:{backgroundColor:e.colors.cellBackground,padding:e.spaces.space12,zIndex:1},searchInputBorder:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:"1px"}}))),Pr=I(Lr);t.a=Pr}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.DMDrawer.05f22e65.js.map